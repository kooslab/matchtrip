<!doctype html>
<html lang="ko">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>오프라인 - 매치트립</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family:
					-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				min-height: 100vh;
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 20px;
			}

			.container {
				background: white;
				border-radius: 20px;
				padding: 40px;
				max-width: 400px;
				width: 100%;
				text-align: center;
				box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
			}

			.icon {
				width: 120px;
				height: 120px;
				margin: 0 auto 30px;
				background: #f3f4f6;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 60px;
			}

			h1 {
				color: #1f2937;
				font-size: 28px;
				margin-bottom: 15px;
				font-weight: 700;
			}

			p {
				color: #6b7280;
				font-size: 16px;
				line-height: 1.6;
				margin-bottom: 30px;
			}

			.features {
				text-align: left;
				margin: 30px 0;
			}

			.feature {
				display: flex;
				align-items: center;
				margin-bottom: 15px;
				color: #4b5563;
			}

			.feature-icon {
				width: 24px;
				height: 24px;
				margin-right: 12px;
				flex-shrink: 0;
			}

			button {
				background: #1095f4;
				color: white;
				border: none;
				padding: 12px 30px;
				font-size: 16px;
				border-radius: 8px;
				cursor: pointer;
				font-weight: 600;
				transition: background 0.3s;
			}

			button:hover {
				background: #0c7cd5;
			}

			button:disabled {
				background: #9ca3af;
				cursor: not-allowed;
			}

			.status {
				margin-top: 20px;
				padding: 10px;
				background: #fef3c7;
				border-radius: 8px;
				color: #92400e;
				font-size: 14px;
				display: none;
			}

			.status.online {
				background: #d1fae5;
				color: #065f46;
			}

			.status.show {
				display: block;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="icon">📡</div>
			<h1>인터넷 연결 없음</h1>
			<p>
				현재 오프라인 상태입니다.<br />
				인터넷 연결을 확인해 주세요.
			</p>

			<div class="features">
				<div class="feature">
					<span class="feature-icon">✓</span>
					<span>이 앱은 오프라인에서도 일부 기능을 사용할 수 있습니다</span>
				</div>
				<div class="feature">
					<span class="feature-icon">✓</span>
					<span>연결이 복구되면 자동으로 동기화됩니다</span>
				</div>
				<div class="feature">
					<span class="feature-icon">✓</span>
					<span>캐시된 데이터는 계속 접근 가능합니다</span>
				</div>
			</div>

			<button id="retryBtn" onclick="checkConnection()">다시 시도</button>

			<div id="status" class="status">연결 상태를 확인하는 중...</div>
		</div>

		<script>
			let retryCount = 0;
			const maxRetries = 3;

			function checkConnection() {
				const btn = document.getElementById('retryBtn');
				const status = document.getElementById('status');

				btn.disabled = true;
				btn.textContent = '확인 중...';
				status.className = 'status show';
				status.textContent = '연결 상태를 확인하는 중...';

				fetch('/api/health', { method: 'HEAD' })
					.then(() => {
						// Connection restored
						status.className = 'status online show';
						status.textContent = '연결이 복구되었습니다! 페이지를 새로고침합니다...';
						setTimeout(() => {
							window.location.reload();
						}, 1500);
					})
					.catch(() => {
						// Still offline
						retryCount++;
						btn.disabled = false;

						if (retryCount >= maxRetries) {
							btn.textContent = '새로고침';
							status.textContent = `여전히 오프라인 상태입니다. 잠시 후 다시 시도해 주세요.`;
							retryCount = 0;
						} else {
							btn.textContent = '다시 시도';
							status.textContent = `연결할 수 없습니다. (시도 ${retryCount}/${maxRetries})`;
						}
					});
			}

			// Auto-check connection every 30 seconds
			setInterval(() => {
				fetch('/api/health', { method: 'HEAD' })
					.then(() => {
						window.location.reload();
					})
					.catch(() => {
						// Still offline, do nothing
					});
			}, 30000);

			// Listen for online event
			window.addEventListener('online', () => {
				checkConnection();
			});
		</script>
	</body>
</html>
